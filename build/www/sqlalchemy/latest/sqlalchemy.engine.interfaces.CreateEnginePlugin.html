<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>sqlalchemy.engine.interfaces.CreateEnginePlugin</title>
    <meta name="generator" content="pydoctor 22.2.0"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=0.75" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    

    <nav class="navbar navbar-default">
  
  <div class="container">

    <div class="navbar-header">
      
      <div class="navlinks">
          <span class="navbar-brand">
            sqlalchemy <a href="index.html">API Documentation</a>
          </span>

          <a href="moduleIndex.html">
            Modules
          </a>

          <a href="classIndex.html">
            Classes
          </a>

          <a href="nameIndex.html">
            Names
          </a>
      </div>

    </div>
  </div>
</nav>

    

    <div class="container">

      <div class="page-header">
        <h1 class="class"><code><code><a href="index.html" class="internal-link">sqlalchemy</a></code><wbr></wbr>.<code><a href="sqlalchemy.engine.html" class="internal-link" title="sqlalchemy.engine">engine</a></code><wbr></wbr>.<code><a href="sqlalchemy.engine.interfaces.html" class="internal-link" title="sqlalchemy.engine.interfaces">interfaces</a></code><wbr></wbr>.<code><a href="sqlalchemy.engine.interfaces.CreateEnginePlugin.html" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin">CreateEnginePlugin</a></code></code></h1>
        <div id="showPrivate">
          <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
        </div>
      </div>

      <div class="categoryHeader">
        class documentation
      </div>

      <div class="extrasDocstring">
        <p><code><span class="py-keyword">class</span> <span class="py-defname">CreateEnginePlugin</span>(object):</code></p>
        <p><a href="classIndex.html#sqlalchemy.engine.interfaces.CreateEnginePlugin">View In Hierarchy</a></p>
      </div>

      <div class="moduleDocstring">
        <div><p>A set of hooks intended to augment the construction of an
<code>_engine.Engine</code> object based on entrypoint names in a URL.</p>
<p>The purpose of <code>_engine.CreateEnginePlugin</code> is to allow third-party
systems to apply engine, pool and dialect level event listeners without
the need for the target application to be modified; instead, the plugin
names can be added to the database URL.  Target applications for
<code>_engine.CreateEnginePlugin</code> include:</p>
<ul class="rst-simple">
<li>connection and SQL performance tools, e.g. which use events to track
number of checkouts and/or time spent with statements</li>
<li>connectivity plugins such as proxies</li>
</ul>
<p>A rudimentary <code>_engine.CreateEnginePlugin</code> that attaches a logger
to an <code>_engine.Engine</code> object might look like:</p>
<pre class="rst-literal-block">
import logging

from sqlalchemy.engine import CreateEnginePlugin
from sqlalchemy import event

class LogCursorEventsPlugin(CreateEnginePlugin):
    def __init__(self, url, kwargs):
        # consume the parameter "log_cursor_logging_name" from the
        # URL query
        logging_name = url.query.get("log_cursor_logging_name", "log_cursor")

        self.log = logging.getLogger(logging_name)

    def update_url(self, url):
        "update the URL to one that no longer includes our parameters"
        return url.difference_update_query(["log_cursor_logging_name"])

    def engine_created(self, engine):
        "attach an event listener after the new Engine is constructed"
        event.listen(engine, "before_cursor_execute", self._log_event)


    def _log_event(
        self,
        conn,
        cursor,
        statement,
        parameters,
        context,
        executemany):

        self.log.info("Plugin logged cursor event: %s", statement)
</pre>
<p>Plugins are registered using entry points in a similar way as that
of dialects:</p>
<pre class="rst-literal-block">
entry_points={
    'sqlalchemy.plugins': [
        'log_cursor_plugin = myapp.plugins:LogCursorEventsPlugin'
    ]
</pre>
<p>A plugin that uses the above names would be invoked from a database
URL as in:</p>
<pre class="rst-literal-block">
from sqlalchemy import create_engine

engine = create_engine(
    "mysql+pymysql://scott:tiger@localhost/test?"
    "plugin=log_cursor_plugin&amp;log_cursor_logging_name=mylogger"
)
</pre>
<p>The <tt class="rst-docutils literal">plugin</tt> URL parameter supports multiple instances, so that a URL
may specify multiple plugins; they are loaded in the order stated
in the URL:</p>
<pre class="rst-literal-block">
engine = create_engine(
  "mysql+pymysql://scott:tiger@localhost/test?"
  "plugin=plugin_one&amp;plugin=plugin_twp&amp;plugin=plugin_three")
</pre>
<p>The plugin names may also be passed directly to <code>_sa.create_engine</code>
using the <a href="#system-message-1"><span class="rst-problematic" id="rst-problematic-1">:paramref:`_sa.create_engine.plugins`</span></a> argument:</p>
<pre class="rst-literal-block">
engine = create_engine(
  "mysql+pymysql://scott:tiger@localhost/test",
  plugins=["myplugin"])
</pre>
<div class="rst-versionadded">
<span class="rst-versionmodified rst-added">New in version 1.2.3: </span><span>plugin names can also be specified
to <code>_sa.create_engine</code> as a list</span></div>
<p>A plugin may consume plugin-specific arguments from the
<code>_engine.URL</code> object as well as the <tt class="rst-docutils literal">kwargs</tt> dictionary, which is
the dictionary of arguments passed to the <code>_sa.create_engine</code>
call.  "Consuming" these arguments includes that they must be removed
when the plugin initializes, so that the arguments are not passed along
to the <code>_engine.Dialect</code> constructor, where they will raise an
<code>_exc.ArgumentError</code> because they are not known by the dialect.</p>
<p>As of version 1.4 of SQLAlchemy, arguments should continue to be consumed
from the <tt class="rst-docutils literal">kwargs</tt> dictionary directly, by removing the values with a
method such as <tt class="rst-docutils literal">dict.pop</tt>. Arguments from the <code>_engine.URL</code> object
should be consumed by implementing the
<code>_engine.CreateEnginePlugin.update_url</code> method, returning a new copy
of the <code>_engine.URL</code> with plugin-specific parameters removed:</p>
<pre class="rst-literal-block">
class MyPlugin(CreateEnginePlugin):
    def __init__(self, url, kwargs):
        self.my_argument_one = url.query['my_argument_one']
        self.my_argument_two = url.query['my_argument_two']
        self.my_argument_three = kwargs.pop('my_argument_three', None)

    def update_url(self, url):
        return url.difference_update_query(
            ["my_argument_one", "my_argument_two"]
        )
</pre>
<p>Arguments like those illustrated above would be consumed from a
<code>_sa.create_engine</code> call such as:</p>
<pre class="rst-literal-block">
from sqlalchemy import create_engine

engine = create_engine(
  "mysql+pymysql://scott:tiger@localhost/test?"
  "plugin=myplugin&amp;my_argument_one=foo&amp;my_argument_two=bar",
  my_argument_three='bat'
)
</pre>
<div class="rst-versionchanged">
<p><span class="rst-versionmodified rst-changed">Changed in version 1.4: </span><span>The <code>_engine.URL</code> object is now immutable; a
<code>_engine.CreateEnginePlugin</code> that needs to alter the
<code>_engine.URL</code> should implement the newly added
<code>_engine.CreateEnginePlugin.update_url</code> method, which
is invoked after the plugin is constructed.</span></p>
<p>For migration, construct the plugin in the following way, checking
for the existence of the <code>_engine.CreateEnginePlugin.update_url</code>
method to detect which version is running:</p>
<pre class="rst-literal-block">
class MyPlugin(CreateEnginePlugin):
    def __init__(self, url, kwargs):
        if hasattr(CreateEnginePlugin, "update_url"):
            # detect the 1.4 API
            self.my_argument_one = url.query['my_argument_one']
            self.my_argument_two = url.query['my_argument_two']
        else:
            # detect the 1.3 and earlier API - mutate the
            # URL directly
            self.my_argument_one = url.query.pop('my_argument_one')
            self.my_argument_two = url.query.pop('my_argument_two')

        self.my_argument_three = kwargs.pop('my_argument_three', None)

    def update_url(self, url):
        # this method is only called in the 1.4 version
        return url.difference_update_query(
            ["my_argument_one", "my_argument_two"]
        )
</pre>
<div class="rst-admonition seealso">
<p class="rst-first rst-admonition-title">See Also</p>
<p class="rst-last"><a href="#system-message-2"><span class="rst-problematic" id="rst-problematic-2">:ref:`change_5526`</span></a> - overview of the <code>_engine.URL</code> change which
also includes notes regarding <code>_engine.CreateEnginePlugin</code>.</p>
</div>
</div>
<p>When the engine creation process completes and produces the
<code>_engine.Engine</code> object, it is again passed to the plugin via the
<code>_engine.CreateEnginePlugin.engine_created</code> hook.  In this hook, additional
changes can be made to the engine, most typically involving setup of
events (e.g. those defined in <a href="#system-message-3"><span class="rst-problematic" id="rst-problematic-3">:ref:`core_event_toplevel`</span></a>).</p>
<div class="rst-versionadded">
<span class="rst-versionmodified rst-added">New in version 1.1.</span></div>
</div>
      </div>

      <div id="splitTables">
        <table class="children sortable" id="id16241">
  
  
  <tr class="method">
    
    <td>Method</td>
    <td><code><a href="#__init__" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin.__init__">__init__</a></code></td>
    <td>Construct a new <code>.CreateEnginePlugin</code>.</td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><code><a href="#engine_created" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin.engine_created">engine​_created</a></code></td>
    <td>Receive the <code>_engine.Engine</code> object when it is fully constructed.</td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><code><a href="#handle_dialect_kwargs" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin.handle_dialect_kwargs">handle​_dialect​_kwargs</a></code></td>
    <td>parse and modify dialect kwargs</td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><code><a href="#handle_pool_kwargs" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin.handle_pool_kwargs">handle​_pool​_kwargs</a></code></td>
    <td>parse and modify pool kwargs</td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><code><a href="#update_url" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin.update_url">update​_url</a></code></td>
    <td>Update the <code>_engine.URL</code>.</td>
  </tr><tr class="instancevariable">
    
    <td>Instance Variable</td>
    <td><code><a href="#url" class="internal-link" title="sqlalchemy.engine.interfaces.CreateEnginePlugin.url">url</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
        

          
      </div>

      <div id="childList">

        <div class="basemethod">
  
  
  <a name="sqlalchemy.engine.interfaces.CreateEnginePlugin.__init__">
    
  </a>
  <a name="__init__">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">__init__</span>(self, url, kwargs):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>Construct a new <code>.CreateEnginePlugin</code>.</p>
<p>The plugin object is instantiated individually for each call
to <code>_sa.create_engine</code>.  A single <code>_engine.
Engine</code> will be
passed to the <code>.CreateEnginePlugin.engine_created</code> method
corresponding to this URL.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">url</span></td><td class="fieldArgDesc"><p>the <code>_engine.URL</code> object.  The plugin may inspect
the <code>_engine.URL</code> for arguments.  Arguments used by the
plugin should be removed, by returning an updated <code>_engine.URL</code>
from the <code>_engine.CreateEnginePlugin.update_url</code> method.</p>
<div class="rst-versionchanged">
<span class="rst-versionmodified rst-changed">Changed in version 1.4: </span><span>The <code>_engine.URL</code> object is now immutable, so a
<code>_engine.CreateEnginePlugin</code> that needs to alter the
<code>_engine.URL</code> object should implement the
<code>_engine.CreateEnginePlugin.update_url</code> method.</span></div>
</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">kwargs</span></td><td class="fieldArgDesc">The keyword arguments passed to
<code>_sa.create_engine</code>.</td></tr></table></div>
  </div>
</div><div class="basemethod">
  
  
  <a name="sqlalchemy.engine.interfaces.CreateEnginePlugin.engine_created">
    
  </a>
  <a name="engine_created">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">engine_created</span>(self, engine):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>Receive the <code>_engine.Engine</code>
object when it is fully constructed.</p>
<p>The plugin may make additional changes to the engine, such as
registering engine or connection pool events.</p>
</div>
  </div>
</div><div class="basemethod">
  
  
  <a name="sqlalchemy.engine.interfaces.CreateEnginePlugin.handle_dialect_kwargs">
    
  </a>
  <a name="handle_dialect_kwargs">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">handle_dialect_kwargs</span>(self, dialect_cls, dialect_args):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div>parse and modify dialect kwargs</div>
  </div>
</div><div class="basemethod">
  
  
  <a name="sqlalchemy.engine.interfaces.CreateEnginePlugin.handle_pool_kwargs">
    
  </a>
  <a name="handle_pool_kwargs">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">handle_pool_kwargs</span>(self, pool_cls, pool_args):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div>parse and modify pool kwargs</div>
  </div>
</div><div class="basemethod">
  
  
  <a name="sqlalchemy.engine.interfaces.CreateEnginePlugin.update_url">
    
  </a>
  <a name="update_url">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">update_url</span>(self, url):
    
  </div>
  <div class="docstring functionBody">
    
    
    <div><p>Update the <code>_engine.URL</code>.</p>
<p>A new <code>_engine.URL</code> should be returned.   This method is
typically used to consume configuration arguments from the
<code>_engine.URL</code> which must be removed, as they will not be
recognized by the dialect.  The
<code>_engine.URL.difference_update_query</code> method is available
to remove these arguments.   See the docstring at
<code>_engine.CreateEnginePlugin</code> for an example.</p>
<div class="rst-versionadded">
<span class="rst-versionmodified rst-added">New in version 1.4.</span></div>
</div>
  </div>
</div><div class="baseinstancevariable">
  
  
  <a name="sqlalchemy.engine.interfaces.CreateEnginePlugin.url">
    
  </a>
  <a name="url">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">url</span> =
    
  </div>
  <div class="functionBody">
    
    
    <div><p class="undocumented">Undocumented</p></div>
    
  </div>
</div>

      </div>
    </div>

    <footer class="navbar navbar-default">
  
  <div class="container">
    <a href="index.html">API Documentation</a> for sqlalchemy,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    22.2.0 at 2022-02-23 04:41:59.
  </div>
</footer>

    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>